"use strict";(self.webpackChunkfluss_website=self.webpackChunkfluss_website||[]).push([[9456],{1264:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"engine-flink/ddl","title":"Flink DDL","description":"\x3c!--","source":"@site/docs/engine-flink/ddl.md","sourceDirName":"engine-flink","slug":"/engine-flink/ddl","permalink":"/docs/next/engine-flink/ddl","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/fluss/edit/main/website/docs/engine-flink/ddl.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"DDL","title":"Flink DDL","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Getting Started","permalink":"/docs/next/engine-flink/getting-started"},"next":{"title":"Writes","permalink":"/docs/next/engine-flink/writes"}}');var a=n(4848),l=n(8453);const s={sidebar_label:"DDL",title:"Flink DDL",sidebar_position:2},r="Flink DDL",d={},o=[{value:"Create Catalog",id:"create-catalog",level:2},{value:"Create Database",id:"create-database",level:2},{value:"Drop Database",id:"drop-database",level:2},{value:"Create Table",id:"create-table",level:2},{value:"PrimaryKey Table",id:"primarykey-table",level:3},{value:"Log Table",id:"log-table",level:3},{value:"Partitioned (PrimaryKey/Log) Table",id:"partitioned-primarykeylog-table",level:3},{value:"Multi-Fields Partitioned Table",id:"multi-fields-partitioned-table",level:4},{value:"Auto partitioned (PrimaryKey/Log) table",id:"auto-partitioned-primarykeylog-table",level:4},{value:"Options",id:"options",level:3},{value:"Create Table Like",id:"create-table-like",level:2},{value:"Drop Table",id:"drop-table",level:2},{value:"Add Partition",id:"add-partition",level:2},{value:"Show Partitions",id:"show-partitions",level:2},{value:"Drop Partition",id:"drop-partition",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"flink-ddl",children:"Flink DDL"})}),"\n",(0,a.jsx)(t.h2,{id:"create-catalog",children:"Create Catalog"}),"\n",(0,a.jsx)(t.p,{children:"Fluss supports creating and managing tables through the Fluss Catalog."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE CATALOG fluss_catalog WITH (\n  'type' = 'fluss',\n  'bootstrap.servers' = 'fluss-server-1:9123'\n);\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"USE CATALOG fluss_catalog;\n"})}),"\n",(0,a.jsx)(t.p,{children:"The following properties can be set if using the Fluss catalog:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{children:"Option"}),(0,a.jsx)(t.th,{children:"Required"}),(0,a.jsx)(t.th,{children:"Default"}),(0,a.jsx)(t.th,{children:"Description"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"type"}),(0,a.jsx)(t.td,{children:"required"}),(0,a.jsx)(t.td,{children:"(none)"}),(0,a.jsx)(t.td,{children:"Catalog type, must to be 'fluss' here."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"bootstrap.servers"}),(0,a.jsx)(t.td,{children:"required"}),(0,a.jsx)(t.td,{children:"(none)"}),(0,a.jsx)(t.td,{children:"Comma separated list of Fluss servers."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"default-database"}),(0,a.jsx)(t.td,{children:"optional"}),(0,a.jsx)(t.td,{children:"fluss"}),(0,a.jsx)(t.td,{children:"The default database to use when switching to this catalog."})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:"client.security.protocol"}),(0,a.jsx)(t.td,{children:"optional"}),(0,a.jsx)(t.td,{children:"PLAINTEXT"}),(0,a.jsxs)(t.td,{children:["The security protocol used to communicate with brokers. Currently, only ",(0,a.jsx)(t.code,{children:"PLAINTEXT"})," and ",(0,a.jsx)(t.code,{children:"SASL"})," are supported, the configuration value is case insensitive."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{children:(0,a.jsx)(t.code,{children:"client.security.{protocol}.*"})}),(0,a.jsx)(t.td,{children:"optional"}),(0,a.jsx)(t.td,{children:"(none)"}),(0,a.jsxs)(t.td,{children:["Client-side configuration properties for a specific authentication protocol. E.g., client.security.sasl.jaas.config. More Details in ",(0,a.jsx)(t.a,{href:"/docs/next/security/authentication",children:"authentication"})]})]})]})]}),"\n",(0,a.jsxs)(t.p,{children:["The following introduced statements assuming the current catalog is switched to the Fluss catalog using ",(0,a.jsx)(t.code,{children:"USE CATALOG <catalog_name>"})," statement."]}),"\n",(0,a.jsx)(t.h2,{id:"create-database",children:"Create Database"}),"\n",(0,a.jsxs)(t.p,{children:["By default, FlussCatalog will use the ",(0,a.jsx)(t.code,{children:"fluss"})," database in Flink. Using the following example to create a separate database in order to avoid creating tables under the default ",(0,a.jsx)(t.code,{children:"fluss"})," database:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE DATABASE my_db;\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"USE my_db;\n"})}),"\n",(0,a.jsx)(t.h2,{id:"drop-database",children:"Drop Database"}),"\n",(0,a.jsx)(t.p,{children:"To delete a database, this will drop all the tables in the database as well:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- Flink doesn't allow drop current database, switch to Fluss default database\nUSE fluss;\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- drop the database\nDROP DATABASE my_db;\n"})}),"\n",(0,a.jsx)(t.h2,{id:"create-table",children:"Create Table"}),"\n",(0,a.jsx)(t.h3,{id:"primarykey-table",children:"PrimaryKey Table"}),"\n",(0,a.jsxs)(t.p,{children:["The following SQL statement will create a ",(0,a.jsx)(t.a,{href:"/docs/next/table-design/table-types/pk-table/",children:"PrimaryKey Table"})," with a primary key consisting of shop_id and user_id."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_pk_table (\n  shop_id BIGINT,\n  user_id BIGINT,\n  num_orders INT,\n  total_amount INT,\n  PRIMARY KEY (shop_id, user_id) NOT ENFORCED\n) WITH (\n  'bucket.num' = '4'\n);\n"})}),"\n",(0,a.jsx)(t.h3,{id:"log-table",children:"Log Table"}),"\n",(0,a.jsxs)(t.p,{children:["The following SQL statement creates a ",(0,a.jsx)(t.a,{href:"/docs/next/table-design/table-types/log-table",children:"Log Table"})," by not specifying primary key clause."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_log_table (\n  order_id BIGINT,\n  item_id BIGINT,\n  amount INT,\n  address STRING\n) WITH (\n  'bucket.num' = '8'\n);\n"})}),"\n",(0,a.jsx)(t.h3,{id:"partitioned-primarykeylog-table",children:"Partitioned (PrimaryKey/Log) Table"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Currently, Fluss only supports partitioned field with ",(0,a.jsx)(t.code,{children:"STRING"})," type"]}),"\n",(0,a.jsxs)(t.li,{children:["For the Partitioned PrimaryKey Table, the partitioned field (",(0,a.jsx)(t.code,{children:"dt"})," in this case) must be a subset of the primary key (",(0,a.jsx)(t.code,{children:"dt, shop_id, user_id"})," in this case)"]}),"\n"]})}),"\n",(0,a.jsx)(t.p,{children:"The following SQL statement creates a Partitioned PrimaryKey Table in Fluss."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_part_pk_table (\n  dt STRING,\n  shop_id BIGINT,\n  user_id BIGINT,\n  num_orders INT,\n  total_amount INT,\n  PRIMARY KEY (dt, shop_id, user_id) NOT ENFORCED\n) PARTITIONED BY (dt);\n"})}),"\n",(0,a.jsx)(t.p,{children:"The following SQL statement creates a Partitioned Log Table in Fluss."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_part_log_table (\n  order_id BIGINT,\n  item_id BIGINT,\n  amount INT,\n  address STRING,\n  dt STRING\n) PARTITIONED BY (dt);\n"})}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["Fluss partitioned table supports dynamic partition creation, which means you can write data into a partition without pre-creating it.\nYou can use the ",(0,a.jsx)(t.code,{children:"INSERT INTO"})," statement to write data into a partitioned table, and Fluss will automatically create the partition if it does not exist.\nSee the ",(0,a.jsx)(t.a,{href:"/docs/next/table-design/data-distribution/partitioning#dynamic-partitioning",children:"Dynamic Partitioning"})," for more details.\nBut you can still use the ",(0,a.jsx)(t.a,{href:"/docs/next/engine-flink/ddl#add-partition",children:"Add Partition"})," statement to manually add partitions if needed."]})}),"\n",(0,a.jsx)(t.h4,{id:"multi-fields-partitioned-table",children:"Multi-Fields Partitioned Table"}),"\n",(0,a.jsxs)(t.p,{children:["Fluss also support ",(0,a.jsx)(t.a,{href:"/docs/next/table-design/data-distribution/partitioning#multi-field-partitioned-tables",children:"Multi-Fields Partitioning"}),", the following SQL statement creates a Multi-Fields Partitioned Log Table in Fluss:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_multi_fields_part_log_table (\n  order_id BIGINT,\n  item_id BIGINT,\n  amount INT,\n  address STRING,\n  dt STRING,\n  nation STRING\n) PARTITIONED BY (dt, nation);\n"})}),"\n",(0,a.jsx)(t.h4,{id:"auto-partitioned-primarykeylog-table",children:"Auto partitioned (PrimaryKey/Log) table"}),"\n",(0,a.jsx)(t.p,{children:"Fluss also support creat Auto Partitioned (PrimaryKey/Log) Table. The following SQL statement creates an Auto Partitioned PrimaryKey Table in Fluss."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_auto_part_pk_table (\n  dt STRING,\n  shop_id BIGINT,\n  user_id BIGINT,\n  num_orders INT,\n  total_amount INT,\n  PRIMARY KEY (dt, shop_id, user_id) NOT ENFORCED\n) PARTITIONED BY (dt) WITH (\n  'bucket.num' = '4',\n  'table.auto-partition.enabled' = 'true',\n  'table.auto-partition.time-unit' = 'day'\n);\n"})}),"\n",(0,a.jsx)(t.p,{children:"The following SQL statement creates an Auto Partitioned Log Table in Fluss."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"CREATE TABLE my_auto_part_log_table (\n  order_id BIGINT,\n  item_id BIGINT,\n  amount INT,\n  address STRING,\n  dt STRING\n) PARTITIONED BY (dt) WITH (\n  'bucket.num' = '8',\n  'table.auto-partition.enabled' = 'true',\n  'table.auto-partition.time-unit' = 'hour'\n);\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details about Auto Partitioned (PrimaryKey/Log) Table, refer to ",(0,a.jsx)(t.a,{href:"/docs/next/table-design/data-distribution/partitioning#auto-partitioning",children:"Auto Partitioning"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"options",children:"Options"}),"\n",(0,a.jsxs)(t.p,{children:["The supported option in ",(0,a.jsx)(t.code,{children:"WITH"})," parameters when creating a table are listed in ",(0,a.jsx)(t.a,{href:"/docs/next/engine-flink/options",children:"Connector Options"})," page."]}),"\n",(0,a.jsx)(t.h2,{id:"create-table-like",children:"Create Table Like"}),"\n",(0,a.jsxs)(t.p,{children:["To create a table with the same schema, partitioning, and table properties as another table, use ",(0,a.jsx)(t.code,{children:"CREATE TABLE LIKE"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- there is a temporary datagen table\nCREATE TEMPORARY TABLE datagen (\n    user_id BIGINT,\n    item_id BIGINT,\n    behavior STRING,\n    dt STRING,\n    hh STRING\n) WITH (\n    'connector' = 'datagen',\n    'rows-per-second' = '10'\n);\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- creates Fluss table which derives the metadata from the temporary table excluding options\nCREATE TABLE my_table LIKE datagen (EXCLUDING OPTIONS);\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details, refer to the ",(0,a.jsx)(t.a,{href:"https://nightlies.apache.org/flink/flink-docs-release-1.20/docs/dev/table/sql/create/#like",children:"Flink CREATE TABLE"})," documentation."]}),"\n",(0,a.jsx)(t.h2,{id:"drop-table",children:"Drop Table"}),"\n",(0,a.jsx)(t.p,{children:"To delete a table, run:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"DROP TABLE my_table;\n"})}),"\n",(0,a.jsx)(t.p,{children:"This will entirely remove all the data of the table in the Fluss cluster."}),"\n",(0,a.jsx)(t.h2,{id:"add-partition",children:"Add Partition"}),"\n",(0,a.jsx)(t.p,{children:"Fluss support manually add partitions to an exists partitioned table by Fluss Catalog. If the specified partition\nnot exists, Fluss will create the partition. If the specified partition already exists, Fluss will ignore the request\nor throw an exception."}),"\n",(0,a.jsx)(t.p,{children:"To add partitions, run:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- Add a partition to a single field partitioned table\nALTER TABLE my_part_pk_table ADD PARTITION (dt = '2025-03-05');\n\n-- Add a partition to a multi-field partitioned table\nALTER TABLE my_multi_fields_part_log_table ADD PARTITION (dt = '2025-03-05', nation = 'US');\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details, refer to the ",(0,a.jsx)(t.a,{href:"https://nightlies.apache.org/flink/flink-docs-release-1.20/docs/dev/table/sql/alter/#add",children:"Flink ALTER TABLE(ADD)"})," documentation."]}),"\n",(0,a.jsx)(t.h2,{id:"show-partitions",children:"Show Partitions"}),"\n",(0,a.jsx)(t.p,{children:"To show all the partitions of a partitioned table, run:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"SHOW PARTITIONS my_part_pk_table;\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For multi-field partitioned tables, you can use the ",(0,a.jsx)(t.code,{children:"SHOW PARTITIONS"})," command with either ",(0,a.jsx)(t.strong,{children:"partial"})," or ",(0,a.jsx)(t.strong,{children:"full"})," partition field conditions to list matching partitions."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- Show partitions using a partial partition filter\nSHOW PARTITIONS my_multi_fields_part_log_table PARTITION (dt = '2025-03-05');\n\n-- Show partitions using a full partition filter\nSHOW PARTITIONS my_multi_fields_part_log_table PARTITION (dt = '2025-03-05', nation = 'US');\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details, refer to the ",(0,a.jsx)(t.a,{href:"https://nightlies.apache.org/flink/flink-docs-release-1.20/docs/dev/table/sql/show/#show-partitions",children:"Flink SHOW PARTITIONS"})," documentation."]}),"\n",(0,a.jsx)(t.h2,{id:"drop-partition",children:"Drop Partition"}),"\n",(0,a.jsx)(t.p,{children:"Fluss also support manually drop partitions from an exists partitioned table by Fluss Catalog. If the specified partition\nnot exists, Fluss will ignore the request or throw an exception."}),"\n",(0,a.jsx)(t.p,{children:"To drop partitions, run:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- Drop a partition from a single field partitioned table\nALTER TABLE my_part_pk_table DROP PARTITION (dt = '2025-03-05');\n\n-- Drop a partition from a multi-field partitioned table\nALTER TABLE my_multi_fields_part_log_table DROP PARTITION (dt = '2025-03-05', nation = 'US');\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For more details, refer to the ",(0,a.jsx)(t.a,{href:"https://nightlies.apache.org/flink/flink-docs-release-1.20/docs/dev/table/sql/alter/#drop",children:"Flink ALTER TABLE(DROP)"})," documentation."]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(6540);const a={},l=i.createContext(a);function s(e){const t=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(l.Provider,{value:t},e.children)}}}]);