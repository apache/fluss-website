"use strict";(self.webpackChunkfluss_website=self.webpackChunkfluss_website||[]).push([[5503],{8467:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"streaming-lakehouse/integrate-data-lakes/paimon","title":"Paimon","description":"Apache Paimon innovatively combines lake format and LSM structure, bringing efficient updates into the lake architecture.","source":"@site/versioned_docs/version-0.5/streaming-lakehouse/integrate-data-lakes/paimon.md","sourceDirName":"streaming-lakehouse/integrate-data-lakes","slug":"/streaming-lakehouse/integrate-data-lakes/paimon","permalink":"/docs/0.5/streaming-lakehouse/integrate-data-lakes/paimon","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/fluss/edit/main/website/docs/streaming-lakehouse/integrate-data-lakes/paimon.md","tags":[],"version":"0.5","sidebarPosition":1,"frontMatter":{"sidebar_label":"Paimon","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Lakehouse Overview","permalink":"/docs/0.5/streaming-lakehouse/overview"},"next":{"title":"Configuration","permalink":"/docs/0.5/maintenance/configuration"}}');var s=n(4848),i=n(8453);const r={sidebar_label:"Paimon",sidebar_position:1},o="Paimon",l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Read tables",id:"read-tables",level:2},{value:"Read by Flink",id:"read-by-flink",level:3},{value:"Read data only in Paimon",id:"read-data-only-in-paimon",level:4},{value:"Union read data in Fluss and Paimon",id:"union-read-data-in-fluss-and-paimon",level:4},{value:"Read by other engines",id:"read-by-other-engines",level:3},{value:"Data Type Mapping",id:"data-type-mapping",level:2}];function h(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"paimon",children:"Paimon"})}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.a,{href:"https://paimon.apache.org/",children:"Apache Paimon"})," innovatively combines lake format and LSM structure, bringing efficient updates into the lake architecture.\nTo integrate Fluss with Paimon, you must enable lakehouse storage and configure Paimon as lakehouse storage. See more detail about ",(0,s.jsx)(a.a,{href:"/docs/0.5/maintenance/tiered-storage/lakehouse-storage#enable-lakehouse-storage",children:"Enable Lakehouse Storage"}),"."]}),"\n",(0,s.jsx)(a.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(a.p,{children:["When a table with option ",(0,s.jsx)(a.code,{children:"'table.datalake.enabled' = 'true'"})," is created or altered in Fluss, Fluss will create a corresponding Paimon table with same table path as well.\nThe schema of the Paimon table is as same as the schema of the Fluss table, except for there are two extra columns ",(0,s.jsx)(a.code,{children:"__offset"})," and ",(0,s.jsx)(a.code,{children:"__timestamp"})," appended to the last.\nThese two columns are used to help Fluss client to consume the data in Paimon in streaming way like seek by offset/timestamp, etc."]}),"\n",(0,s.jsx)(a.p,{children:"Then datalake tiering service compacts the data from Fluss to Paimon continuously. For primary key table, it will also generate change log in Paimon format which\nenables you streaming consume it in Paimon way."}),"\n",(0,s.jsx)(a.h2,{id:"read-tables",children:"Read tables"}),"\n",(0,s.jsx)(a.h3,{id:"read-by-flink",children:"Read by Flink"}),"\n",(0,s.jsxs)(a.p,{children:["For the table with option ",(0,s.jsx)(a.code,{children:"'table.datalake.enabled' = 'true'"}),", there are two part of data: the data remains in Fluss and the data already in Paimon.\nNow, you have two view of the table: one view is the Paimon data which has minute-level latency, one view is the full data union Fluss and Paimon data\nwhich is the latest within second-level latency."]}),"\n",(0,s.jsx)(a.p,{children:"Flink empowers you to decide to choose which view:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Only Paimon means a better analytics performance but with worse data freshness"}),"\n",(0,s.jsx)(a.li,{children:"Combing Fluss and Paimon means a better data freshness but with analytics performance degrading"}),"\n"]}),"\n",(0,s.jsx)(a.h4,{id:"read-data-only-in-paimon",children:"Read data only in Paimon"}),"\n",(0,s.jsxs)(a.p,{children:["To point to read data in Paimon, you must specify the table with ",(0,s.jsx)(a.code,{children:"$lake"})," suffix, the following\nSQL shows how to do that:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- assume we have a table named `orders`\n\n-- read from paimon\nSELECT COUNT(*) FROM orders$lake;\n\n-- we can also query the system tables \nSELECT * FROM orders$lake$snapshots;\n"})}),"\n",(0,s.jsxs)(a.p,{children:["When specify the table with ",(0,s.jsx)(a.code,{children:"$lake"})," suffix in query, it just acts like a normal Paimon table, so it inherits all ability of Paimon table.\nYou can enjoy all the features that Flink's query supports/optimization on Paimon, like query system tables, time travel, etc. See more\nabout Paimon's ",(0,s.jsx)(a.a,{href:"https://paimon.apache.org/docs/0.9/flink/sql-query/#sql-query",children:"sql-query"}),"."]}),"\n",(0,s.jsx)(a.h4,{id:"union-read-data-in-fluss-and-paimon",children:"Union read data in Fluss and Paimon"}),"\n",(0,s.jsx)(a.p,{children:"To point to read the full data that union Fluss and Paimon, you just query it as a normal table without any suffix or others, the following\nSQL shows how to do that:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",metastring:'title="Flink SQL"',children:"-- query will union data of Fluss and Paimon\nSELECT SUM(order_count) as total_orders FROM ads_nation_purchase_power;\n"})}),"\n",(0,s.jsx)(a.p,{children:"The query may look slower than only querying data in Paimon, but it queries the full data which means better data freshness. You can\nrun the query multi-times, you should get different results in every one run as the data is written to the table continuously."}),"\n",(0,s.jsx)(a.h3,{id:"read-by-other-engines",children:"Read by other engines"}),"\n",(0,s.jsxs)(a.p,{children:["As the tiered data in Paimon compacted from Fluss is also a standard Paimon table, you can use\n",(0,s.jsx)(a.a,{href:"https://paimon.apache.org/docs/0.9/engines/overview/",children:"any engines"})," that support Paimon to read the data. Here, we take ",(0,s.jsx)(a.a,{href:"https://paimon.apache.org/docs/master/engines/starrocks/",children:"StarRocks"})," as the engine to read the data:"]}),"\n",(0,s.jsx)(a.p,{children:"First, create a Paimon catalog for StarRocks:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",metastring:'title="StarRocks SQL"',children:'CREATE EXTERNAL CATALOG paimon_catalog\nPROPERTIES\n(\n  "type" = "paimon",\n  "paimon.catalog.type" = "filesystem",\n  "paimon.catalog.warehouse" = "/tmp/paimon_data_warehouse"\n);\n'})}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"NOTE"}),": The configuration value ",(0,s.jsx)(a.code,{children:"paimon.catalog.type"})," and ",(0,s.jsx)(a.code,{children:"paimon.catalog.warehouse"})," should be same as how you configure the Paimon as lakehouse storage for Fluss in ",(0,s.jsx)(a.code,{children:"server.yaml"}),"."]}),"\n",(0,s.jsxs)(a.p,{children:["Then, you can query the ",(0,s.jsx)(a.code,{children:"orders"})," table by StarRocks:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-sql",metastring:'title="StarRocks SQL"',children:"-- the table is in database `fluss`\nSELECT COUNT(*) FROM paimon_catalog.fluss.orders;\n\n-- query the system tables, to know the snapshots of the table\nSELECT * FROM paimon_catalog.fluss.enriched_orders$snapshots;\n"})}),"\n",(0,s.jsx)(a.h2,{id:"data-type-mapping",children:"Data Type Mapping"}),"\n",(0,s.jsxs)(a.p,{children:["When integrate with Paimon, Fluss automatically converts between Fluss data type and Paimon data type.\nThe following content shows the mapping between ",(0,s.jsx)(a.a,{href:"/docs/0.5/table-design/data-types",children:"Fluss data type"})," and Paimon data type:"]}),"\n",(0,s.jsxs)(a.table,{children:[(0,s.jsx)(a.thead,{children:(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.th,{children:"Fluss Data Type"}),(0,s.jsx)(a.th,{children:"Paimon Data Type"})]})}),(0,s.jsxs)(a.tbody,{children:[(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"BOOLEAN"}),(0,s.jsx)(a.td,{children:"BOOLEAN"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"TINYINT"}),(0,s.jsx)(a.td,{children:"TINYINT"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"SMALLINT"}),(0,s.jsx)(a.td,{children:"SMALLINT"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"INT"}),(0,s.jsx)(a.td,{children:"INT"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"BIGINT"}),(0,s.jsx)(a.td,{children:"BIGINT"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"FLOAT"}),(0,s.jsx)(a.td,{children:"FLOAT"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"DOUBLE"}),(0,s.jsx)(a.td,{children:"DOUBLE"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"DECIMAL"}),(0,s.jsx)(a.td,{children:"DECIMAL"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"STRING"}),(0,s.jsx)(a.td,{children:"STRING"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"CHAR"}),(0,s.jsx)(a.td,{children:"CHAR"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"DATE"}),(0,s.jsx)(a.td,{children:"DATE"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"TIME"}),(0,s.jsx)(a.td,{children:"TIME"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"TIMESTAMP"}),(0,s.jsx)(a.td,{children:"TIMESTAMP"})]}),(0,s.jsxs)(a.tr,{children:[(0,s.jsx)(a.td,{children:"TIMESTAMP WITH LOCAL TIMEZONE"}),(0,s.jsx)(a.td,{children:"TIMESTAMP WITH LOCAL TIMEZONE"})]})]})]})]})}function c(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>r,x:()=>o});var t=n(6540);const s={},i=t.createContext(s);function r(e){const a=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function o(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:a},e.children)}}}]);