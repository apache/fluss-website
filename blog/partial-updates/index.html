<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Understanding Partial Updates | Apache Fluss™ (incubating)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://fluss.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://fluss.apache.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://fluss.apache.org/blog/partial-updates/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Understanding Partial Updates | Apache Fluss™ (incubating)"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-06-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/polyzos"><link data-rh="true" rel="icon" href="/img/logo/fluss_favicon.svg"><link data-rh="true" rel="canonical" href="https://fluss.apache.org/blog/partial-updates/"><link data-rh="true" rel="alternate" href="https://fluss.apache.org/blog/partial-updates/" hreflang="en"><link data-rh="true" rel="alternate" href="https://fluss.apache.org/blog/partial-updates/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://D8RXQUTC99-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://fluss.apache.org/blog/partial-updates","mainEntityOfPage":"https://fluss.apache.org/blog/partial-updates","url":"https://fluss.apache.org/blog/partial-updates","headline":"Understanding Partial Updates","name":"Understanding Partial Updates","description":"<!--","datePublished":"2025-06-01T00:00:00.000Z","author":{"@type":"Person","name":"Giannis Polyzos","description":"PPMC member of Apache Fluss (Incubating)","url":"https://github.com/polyzos","image":"https://github.com/polyzos.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://fluss.apache.org/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Fluss™ (incubating) RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Fluss™ (incubating) Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Fluss™ (incubating)" href="/opensearch.xml">


<link rel="icon" href="/img/logo.svg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0071e3"><link rel="stylesheet" href="/assets/css/styles.3ca55d09.css">
<script src="/assets/js/runtime~main.5a5c8b9a.js" defer="defer"></script>
<script src="/assets/js/main.4f2ebb93.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo/svg/colored_logo.svg" alt="Fluss" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo/svg/colored_logo.svg" alt="Fluss" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/learn/talks/">Talks</a></li><li><a class="dropdown__link" href="/learn/videos/">Videos</a></li></ul></div><a class="navbar__item navbar__link" href="/community/welcome/">Community</a><a class="navbar__item navbar__link" href="/roadmap/">Roadmap</a><a class="navbar__item navbar__link" href="/downloads/">Downloads</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/apache/fluss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fluss-joins-asf/">Fluss Joins the Apache Incubator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fluss-java-client/">Apache Fluss Java Client: A Deep Dive</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tiering-service/">Tiering Service Deep Dive</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/releases/0.7/">Announcing Fluss 0.7</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/partial-updates/">Understanding Partial Updates</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/unveil-fluss-logo/">The Story of Fluss Logo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/releases/0.6/">Announcing Fluss 0.6</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/unified-streaming-lakehouse/">Toward Streaming Lakehouse</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fluss-intro/">Introducing Fluss</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/why-fluss/">Why Fluss? Top 4 Challenges of Kafka</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fluss-open-source/">Fluss is Now Open Source</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Understanding Partial Updates</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-06-01T00:00:00.000Z">June 1, 2025</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/polyzos" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/polyzos.png" alt="Giannis Polyzos"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/polyzos" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Giannis Polyzos</span></a></div><small class="authorTitle_nd0D" title="PPMC member of Apache Fluss (Incubating)">PPMC member of Apache Fluss (Incubating)</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" alt="Banner" src="/assets/images/banner-a09e6bac14dc2bee3dbc698347cb2d7f.png" width="1348" height="958" class="img_ev3q"></p>
<p>Traditional streaming data pipelines often need to join many tables or streams on a primary key to create a wide view.
For example, imagine you’re building a real-time recommendation engine for an e-commerce platform.
To serve highly personalized recommendations, your system needs a complete 360° view of each user, including:
<em>user preferences</em>, <em>past purchases</em>, <em>clickstream behavior</em>, <em>cart activity</em>, <em>product reviews</em>, <em>support tickets</em>, <em>ad impressions</em>, and <em>loyalty status</em>.</p>
<p>That’s at least <strong>8 different data sources</strong>, each producing updates independently.</p>
<p>Joining multiple data streams at scale, although it works with Apache Flink it can be really challenging and resource-intensive.
More specifically, it can lead to:</p>
<ul>
<li><strong>Really large state sizes in Flink:</strong> as it needs to buffer all incoming events until they can be joined. In many case states need to be kept around for a long period of time if not indefinitely.</li>
<li><strong>Deal with checkpoints overhead and backpressure:</strong> as the join operation and large state uploading can create a bottleneck in the pipeline.</li>
<li><strong>States are not easy to inspect and debug:</strong> as they are often large and complex. This can make it difficult to understand what is happening in the pipeline and why certain events are not being processed correctly.</li>
<li><strong>State TTL can lead to inconsistent results:</strong> as events may be dropped before they can be joined. This can lead to data loss and incorrect results in the final output.</li>
</ul>
<p>Overall, this approach not only consumes a lot of memory and CPU, but also complicates the job design and maintenance.</p>
<p><img decoding="async" loading="lazy" alt="Streaming Joins" src="/assets/images/streaming_join-761699227c5633f3575e2036b9e2ac61.png" width="1375" height="550" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="partial-updates-a-different-approach-with-fluss">Partial Updates: A Different Approach with Fluss<a href="#partial-updates-a-different-approach-with-fluss" class="hash-link" aria-label="Direct link to Partial Updates: A Different Approach with Fluss" title="Direct link to Partial Updates: A Different Approach with Fluss">​</a></h3>
<p>Fluss introduces a more elegant solution: <strong>partial updates</strong> on a primary key table.</p>
<p>Instead of performing multi-way joins in the streaming job, Fluss allows each data stream source to independently update only its relevant columns into a shared wide table identified by the primary key.
In Fluss, you can define a wide table (for example, a user_profile table based on a <code>user_id</code>) that contains all possible fields from all sources.
Each source stream then writes partial rows – only the fields it knows about – into this table.</p>
<p><img decoding="async" loading="lazy" alt="Partial Update" src="/assets/images/partial_update-d529bf24211a76b31444bc7918872d59.png" width="1488" height="669" class="img_ev3q"></p>
<p>Fluss’s storage engine automatically merges these partial updates together based on the primary key.
Essentially, Fluss maintains the latest combined value for each key, so you don’t have to manage large join states in Flink.</p>
<p>Under the hood, when a new partial update for a key arrives, Fluss will look up the existing record for that primary key, update the specific columns provided, and leave other columns unchanged.
The result is written back as the new version of the record.
This happens in <em>real-time</em>, so the table is <strong>always up-to-date</strong> with the latest information from all streams.</p>
<p>Next, let&#x27;s try and better understand how this works in practice with a concrete example.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-building-a-unified-wide-table">Example: Building a Unified Wide Table<a href="#example-building-a-unified-wide-table" class="hash-link" aria-label="Direct link to Example: Building a Unified Wide Table" title="Direct link to Example: Building a Unified Wide Table">​</a></h3>
<blockquote>
<p>You can find the full source code on github <a href="https://github.com/ververica/ververica-fluss-examples/tree/main/partial_updates" target="_blank" rel="noopener noreferrer">here</a>.</p>
</blockquote>
<p>Start by cloning the repository, run <code>docker compose up</code> to spin up the development enviroment and finally grab a terminal
into the <code>jobmanager</code> and start the Flink SQL cli, by running the following command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./bin/sql-client.sh</span><br></span></code></pre></div></div>
<p>Great so far ! 👍</p>
<p><strong>Step 1:</strong> The first thing we need to do is to create a Flink catalog that will be used to store the tables we are going to create.
Let&#x27;s create a catalog called <code>fluss_catalog</code> and use this catalog.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> CATALOG fluss_catalog </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;type&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;fluss&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bootstrap.servers&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;coordinator-server:9123&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">USE</span><span class="token plain"> CATALOG fluss_catalog</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Step 2:</strong> Then let&#x27;s create <code>3 tables</code> to represent the different data sources that will be used to build the recommendations wide table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Recommendations – model scores</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> recommendations </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id  STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id  STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rec_score </span><span class="token keyword" style="color:rgb(86, 156, 214)">DOUBLE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rec_ts   </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bucket.num&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table.datalake.enabled&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">-- Impressions – how often we showed something</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> impressions </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    imp_cnt </span><span class="token keyword" style="color:rgb(86, 156, 214)">INT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    imp_ts  </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bucket.num&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table.datalake.enabled&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">-- Clicks – user engagement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> clicks </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id  STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id  STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    click_cnt </span><span class="token keyword" style="color:rgb(86, 156, 214)">INT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    clk_ts    </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bucket.num&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table.datalake.enabled&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TABLE</span><span class="token plain"> user_rec_wide </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id   STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id   STRING</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rec_score </span><span class="token keyword" style="color:rgb(86, 156, 214)">DOUBLE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">   </span><span class="token comment" style="color:rgb(106, 153, 85)">-- updated by recs stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    imp_cnt   </span><span class="token keyword" style="color:rgb(86, 156, 214)">INT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">-- updated by impressions stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    click_cnt </span><span class="token keyword" style="color:rgb(86, 156, 214)">INT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">      </span><span class="token comment" style="color:rgb(106, 153, 85)">-- updated by clicks stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">NOT</span><span class="token plain"> ENFORCED</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bucket.num&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;3&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table.datalake.enabled&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;true&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Step 3:</strong> Of course, we will need some sample data to work with , so let&#x27;s go on and insert some records into the tables. 💻</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Recommendations – model scores</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> recommendations </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:15:02&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_502&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:15:05&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_102&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_503&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:16:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_103&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:16:20&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_104&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_504&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:16:45&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Impressions – how often each (user,item) was shown</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> impressions </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:17:10&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_502&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:17:15&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_102&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_503&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:18:22&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_103&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:18:30&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_104&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_504&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:18:55&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Clicks – user engagement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> clicks </span><span class="token keyword" style="color:rgb(86, 156, 214)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:19:00&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_101&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_502&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:19:07&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_102&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_503&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:19:12&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_103&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_501&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:19:20&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;user_104&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;prod_504&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">TIMESTAMP</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;2025-05-16 09:19:25&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>Note:</strong> 🚨 So far the jobs we run were bounded jobs, so they will finish after inserting the records. Moving forward we will run some streaming jobs.
So keep in mind that each job runs with a <code>parallelism of 3</code> and our environment is set up <code>with 10 slots total</code>.
So make sure to keep an eye to the Flink Web UI to see how many slots are used and how many are available and stop some jobs when are no longer needed to free up resourecs.</p>
</blockquote>
<p><strong>Step 4:</strong> At this point let&#x27;s open up a separate terminal and start the Flink SQL CLI.
In this new terminal, make sure to run set the <code>result-mode</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SET </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sql-client.execution.result-mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;tableau&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p>and then run:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> user_rec_wide</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p>to observe the output of the table, as we insert <code>partially</code> records into the it from the different sources.</p>
<p><strong>Step 5:</strong> Let&#x27;s insert the records from the <code>recommendations</code> table into the <code>user_rec_wide</code> table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Apply recommendation scores</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> user_rec_wide </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> rec_score</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rec_score</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> recommendations</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Output:</strong> Notice, how only the related columns are updated in the <code>user_rec_wide</code> table and the rest of the columns are <code>NULL</code>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Flink SQL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> SELECT * FROM user_rec_wide</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">op</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        user_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        item_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                      rec_score </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">     imp_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">   click_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><br></span></code></pre></div></div>
<p><strong>Step 5:</strong> Next, let&#x27;s insert the records from the <code>impressions</code> table into the <code>user_rec_wide</code> table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Apply impression counts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> user_rec_wide </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> imp_cnt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    imp_cnt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> impressions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Output:</strong> Notice how the <code>impressions</code> records are inserted into the <code>user_rec_wide</code> table and the <code>imp_cnt</code> column is updated.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Flink SQL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> SELECT * FROM user_rec_wide</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">op</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        user_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        item_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                      rec_score </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">     imp_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">   click_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><br></span></code></pre></div></div>
<p><strong>Step 6:</strong> Finally, let&#x27;s insert the records from the <code>clicks</code> table into the <code>user_rec_wide</code> table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">-- Apply click counts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">INTO</span><span class="token plain"> user_rec_wide </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> click_cnt</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    user_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    item_id</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    click_cnt</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">FROM</span><span class="token plain"> clicks</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><br></span></code></pre></div></div>
<p><strong>Output:</strong> Notice how the <code>clicks</code> records are inserted into the <code>user_rec_wide</code> table and the <code>click_cnt</code> column is updated.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Flink SQL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> SELECT * FROM user_rec_wide</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">op</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        user_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                        item_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                      rec_score </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">     imp_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">   click_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----+--------------------------------+--------------------------------+--------------------------------+-------------+-------------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +I </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-U</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NULL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> +U </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                       prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">                           </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">           </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><br></span></code></pre></div></div>
<p><strong>Reminder:</strong> ‼️As mentioned before make sure to stop the jobs that are no longer needed to free up resources.</p>
<p>Now let&#x27;s switch to <code>batch</code> mode and query the current snapshot of the <code>user_rec_wide</code> table.</p>
<p>But before that, let&#x27;s start the <a href="https://alibaba.github.io/fluss-docs/docs/maintenance/tiered-storage/lakehouse-storage/#start-the-datalake-tiering-service" target="_blank" rel="noopener noreferrer">Tiering Service</a> that allows offloading the tables as <code>Lakehouse</code> tables.</p>
<p><strong>Step 7:</strong> Open a new terminal 💻 in the <code>Coordinator Server</code> and run the following command to start the <code>Tiering Service</code>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">./bin/lakehouse.sh </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-D</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">flink.rest.address</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">jobmanager </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-D</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">flink.rest.port</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">8081</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-D</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">flink.execution.checkpointing.interval</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">30s </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-D</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">flink.parallelism.default</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><br></span></code></pre></div></div>
<p>The configured checkpoint is <code>flink.execution.checkpointing.interval=30s</code> so wait a bit until the first checkpoint is created
and data gets offloading to the <code>Lakehouse</code> tables.</p>
<p><strong>Step 8:</strong> Finally let&#x27;s switch to <code>batch</code> mode and query the current snapshot of the <code>user_rec_wide</code> table.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SET </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;execution.runtime-mode&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;batch&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Flink SQL</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> SELECT * FROM user_rec_wide</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------+----------+-----------+---------+-----------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  user_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  item_id </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> rec_score </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> imp_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> click_cnt </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------+----------+-----------+---------+-----------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> user_102 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> prod_503 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token number" style="color:rgb(181, 206, 168)">0.83</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">       </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">         </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> user_103 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token number" style="color:rgb(181, 206, 168)">0.67</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">       </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">         </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> prod_501 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token number" style="color:rgb(181, 206, 168)">0.92</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">       </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">         </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> user_101 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> prod_502 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token number" style="color:rgb(181, 206, 168)">0.78</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">       </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">         </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> user_104 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> prod_504 </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">      </span><span class="token number" style="color:rgb(181, 206, 168)">0.88</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">       </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">         </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">+----------+----------+-----------+---------+-----------+</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> rows </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">set</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2.63</span><span class="token plain"> seconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<p>🎉 That&#x27;s it! You have successfully created a unified wide table using partial updates in Fluss.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3>
<p>Partial updates in Fluss enable an alternative approach in how we design streaming data pipelines for enriching or joining data.</p>
<p>When all your sources share a primary key - otherwise you can mix &amp; match <a href="https://alibaba.github.io/fluss-docs/docs/engine-flink/lookups/#lookup" target="_blank" rel="noopener noreferrer">streaming lookup joins</a> - you can turn the problem on its head: update a unified table incrementally, rather than joining streams on the fly.</p>
<p>The result is a more scalable, maintainable, and efficient pipeline.
Engineers can spend less time wrestling with Flink’s state, checkpoints and join mechanics, and more time delivering fresh, integrated data to power real-time analytics and applications.
With Fluss handling the merge logic, achieving a single, up-to-date view from multiple disparate streams becomes way more elegant. 😁</p>
<p>And before you go 😊 don’t forget to give Fluss 🌊 some ❤️ via ⭐ on <a href="https://github.com/alibaba/fluss" target="_blank" rel="noopener noreferrer">GitHub</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/releases/0.7/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Announcing Fluss 0.7</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/unveil-fluss-logo/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">The Story of Fluss Logo</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#partial-updates-a-different-approach-with-fluss" class="table-of-contents__link toc-highlight">Partial Updates: A Different Approach with Fluss</a></li><li><a href="#example-building-a-unified-wide-table" class="table-of-contents__link toc-highlight">Example: Building a Unified Wide Table</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 The Apache Software Foundation.
      Apache®, Apache Flink®, Flink®, Apache Kafka®, Kafka®, Spark® and associated open source project names and logos are trademarks of the Apache Software Foundation.</div></div></div></footer></div>
</body>
</html>